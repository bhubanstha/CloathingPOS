<UserControl x:Class="POSSystem.UI.Views.InventoryListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:POSSystem.UI.Views"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:conv="clr-namespace:POSSystem.UI.Converter"
             xmlns:ctrl="clr-namespace:POSSystem.UI.Controls"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:sc="clr-namespace:POSSystem.UI.Service"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>

        <conv:ColorToBrushConverter x:Key="ColorConverter"/>

        
        
    </UserControl.Resources>
    <StackPanel>
        <Border Style="{StaticResource HeaderBorder }" />

        <Grid x:Name="MainGrid" Margin="0 10 25 0">

            <Grid.RowDefinitions>
                <RowDefinition/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>

            <DataGrid x:Name="CartGrid"
                      Grid.Row="1"
                      Grid.Column="0"
                      Grid.ColumnSpan="3"                              
                      AutoGenerateColumns="False"
                      ItemsSource="{Binding Path=Inventory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      CanUserAddRows="False"
                      CanUserReorderColumns="False"
                      CanUserSortColumns="False"
                      CanUserResizeColumns="False"
                      IsReadOnly="True"
                      BorderThickness="1"
                      Margin="0 0 0 5"
                      Style="{StaticResource MahApps.Styles.DataGrid.Azure}">

                <DataGrid.Columns>
                    <DataGridTextColumn Binding="{Binding Category.Name}" Header="Category" Width="200" />
                    <DataGridTextColumn Binding="{Binding Name}" Header="Name" Width="345"/>
                    <DataGridTextColumn Binding="{Binding Size}" Header="Size" Width="45"/>
                    <DataGridTemplateColumn Header="Colour" >
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Rectangle Fill="{Binding Color, Converter={StaticResource ColorConverter}}" Width="24" Height="20" VerticalAlignment="Top"></Rectangle>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Binding="{Binding Quantity}" Header="Qty" Width="50" ElementStyle="{StaticResource GridNumericColumn}"/>
                    <DataGridTextColumn Binding="{Binding PurchaseRate}" Header="Purchase Rate" Width="110" ElementStyle="{StaticResource GridNumericColumn}"/>
                    <DataGridTextColumn Binding="{Binding RetailRate}" Header="Retail Rate" Width="85" ElementStyle="{StaticResource GridNumericColumn}"/>
                    <DataGridTextColumn Binding="{Binding FirstPurchaseDate, StringFormat=\{0:yyyy/MM/dd\}}" Header="Purchase Date" Width="110" ElementStyle="{StaticResource GridNumericColumn}" HeaderStringFormat="yyyy/MM/dd"/>
                    <DataGridTemplateColumn Header="Options" Width="70">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="30"/>
                                    </Grid.ColumnDefinitions>

                                    <Button Grid.Column="0"
                                            Margin="2 0" 
                                             Width="25" 
                                             Height="25"
                                            Command="{Binding Path=DataContext.DeleteCartItemCommand, 
                                                                RelativeSource = {RelativeSource FindAncestor,
                                                                AncestorType={x:Type DataGrid}}}"
                                             CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                             Foreground="{DynamicResource MahApps.Brushes.Accent}"
                                             Style="{DynamicResource Button.Circle.In.GridRow}">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <iconPacks:PackIconBootstrapIcons Kind="PencilSquare" Width="15" Height="15" 
                                                                                  Style="{StaticResource row.option.icon}"/>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                    <Button Grid.Column="1"
                                            Margin="2 0" 
                                             Width="25" 
                                             Height="25"
                                            Command="{Binding Path=DataContext.DeleteCartItemCommand, 
                                                                RelativeSource = {RelativeSource FindAncestor,
                                                                AncestorType={x:Type DataGrid}}}"
                                             CommandParameter="{Binding RelativeSource={RelativeSource Mode=Self}, Path=DataContext}"
                                             Foreground="{DynamicResource MahApps.Brushes.Accent}"
                                             Style="{DynamicResource Button.Circle.In.GridRow}">
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <iconPacks:PackIconBootstrapIcons Kind="Trash" Width="15" Height="15" 
                                                                                  Style="{StaticResource row.option.icon}"/>

                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                </Grid>

                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>

            </DataGrid>
        </Grid>
    </StackPanel>
</UserControl>
